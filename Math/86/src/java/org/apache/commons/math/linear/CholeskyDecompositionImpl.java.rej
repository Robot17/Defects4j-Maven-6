***************
*** 111,119 ****
  
              final double[] lI = lTData[i];
  
-             if (lTData[i][i] < absolutePositivityThreshold) {
-                 throw new NotPositiveDefiniteMatrixException();
-             }
              // check off-diagonal elements (and reset them to 0)
              for (int j = i + 1; j < order; ++j) {
                  final double[] lJ = lTData[j];
--- 111,116 ----
  
              final double[] lI = lTData[i];
  
              // check off-diagonal elements (and reset them to 0)
              for (int j = i + 1; j < order; ++j) {
                  final double[] lJ = lTData[j];
***************
*** 134,139 ****
              final double[] ltI = lTData[i];
  
              // check diagonal element
  
              ltI[i] = Math.sqrt(ltI[i]);
              final double inverse = 1.0 / ltI[i];
--- 131,139 ----
              final double[] ltI = lTData[i];
  
              // check diagonal element
+             if (ltI[i] < absolutePositivityThreshold) {
+                 throw new NotPositiveDefiniteMatrixException();
+             }
  
              ltI[i] = Math.sqrt(ltI[i]);
              final double inverse = 1.0 / ltI[i];
